---
import Button from "../components/ui/Button.astro";
---

<div class="bg-white p-8 rounded-xl shadow-lg border border-slate-100">
  <div id="success-container" class="hidden text-center py-12">
    <div
      class="w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-6"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-8 w-8 text-teal-600"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
    </div>
    <h3 class="text-2xl font-bold text-slate-900 mb-4">Message Sent!</h3>
    <p class="text-slate-600 mb-8">
      Thanks for reaching out. We'll be in touch shortly to discuss your
      project.
    </p>
    <Button id="reset-button" class="px-6 py-2 border" variant="secondary">
      Send Another Message
    </Button>
  </div>

  <form
    id="contact-form"
    name="contact"
    method="POST"
    data-netlify="true"
    netlify-honeypot="bot-field"
    class="space-y-6"
  >
    <input type="hidden" name="form-name" value="contact" />

    <input type="hidden" name="bot-field" />

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div>
        <label for="name" class="block text-sm font-medium text-slate-700 mb-2"
          >Name <span class="text-red-500">*</span></label
        >
        <input
          type="text"
          name="name"
          id="name"
          required
          class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-teal focus:border-transparent outline-none transition-all"
          placeholder="John Doe"
        />
      </div>
      <div>
        <label for="email" class="block text-sm font-medium text-slate-700 mb-2"
          >Email <span class="text-red-500">*</span></label
        >
        <input
          type="email"
          name="email"
          id="email"
          required
          class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition-all"
          placeholder="john@company.com"
        />
      </div>
    </div>

    <div>
      <label for="company" class="block text-sm font-medium text-slate-700 mb-2"
        >Company (Optional)</label
      >
      <input
        type="text"
        name="company"
        id="company"
        class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition-all"
        placeholder="Your Company Ltd."
      />
    </div>

    <div>
      <label for="service" class="block text-sm font-medium text-slate-700 mb-2"
        >Service Interested In <span class="text-red-500">*</span></label
      >
      <select
        name="service"
        id="service"
        required
        class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition-all bg-white"
      >
        <option>Custom Website Development</option>
        <option>Web Application</option>
        <option>UI/UX Design</option>
        <option>Maintenance & Support</option>
        <option>Other</option>
      </select>
    </div>

    <div>
      <label for="message" class="block text-sm font-medium text-slate-700 mb-2"
        >Project Details <span class="text-red-500">*</span></label
      >
      <textarea
        name="message"
        id="message"
        rows="4"
        required
        class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition-all"
        placeholder="Tell us a bit about your project goals and timeline..."
      ></textarea>
    </div>

    <Button
      id="submit-button"
      type="submit"
      class="w-full px-6 py-3 disabled:opacity-50 disabled:cursor-not-allowed"
      variant="primary"
    >
      Send Message
    </Button>
  </form>
</div>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const successContainer = document.getElementById("success-container");
  const submitButton = document.getElementById(
    "submit-button"
  ) as HTMLButtonElement;
  const resetButton = document.getElementById("reset-button");

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Change button state
    submitButton.disabled = true;
    submitButton.innerText = "Sending...";

    const formData = new FormData(form);

    try {
      const response = await fetch("/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(formData as any).toString(),
      });

      if (response.ok) {
        form.classList.add("hidden");
        successContainer?.classList.remove("hidden");
      } else {
        throw new Error("Form submission failed");
      }
    } catch (error) {
      console.error(error);
      alert("Something went wrong. Please try again.");
      submitButton.disabled = false;
      submitButton.innerText = "Send Message";
    }
  });

  resetButton?.addEventListener("click", () => {
    form.reset();
    form.classList.remove("hidden");
    successContainer?.classList.add("hidden");
    submitButton.disabled = false;
    submitButton.innerText = "Send Message";
  });
</script>
