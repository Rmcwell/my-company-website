---
import { Anchor } from "lucide-astro";
import Button from "./ui/Button.astro";

const currentPath = Astro.url.pathname;

const navLinks = [
    { name: "Home", path: "/" },
    { name: "Services", path: "/services" },
    { name: "Work", path: "/work" },
    { name: "Process", path: "/process" },
    { name: "About", path: "/about" },
];
---

<header
    id="main-header"
    class="fixed w-full z-50 transition-all duration-300 bg-navy py-5"
>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center">
            <!-- Logo -->
            <a href="/" class="flex items-center space-x-2 group">
                <div
                    class="p-2 bg-gold/10 rounded-full border border-gold/30 group-hover:border-gold transition-colors"
                >
                    <Anchor class="h-6 w-6 text-gold" />
                </div>
                <span
                    class="text-xl font-heading font-bold text-white tracking-wide"
                >
                    MARITIME<span class="text-teal">DEV</span>
                </span>
            </a>

            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center space-x-8">
                {
                    navLinks.map((link) => (
                        <a
                            href={link.path}
                            class={`text-sm font-medium transition-colors hover:text-gold ${
                                currentPath === link.path
                                    ? "text-gold"
                                    : "text-slate-300"
                            }`}
                        >
                            {link.name}
                        </a>
                    ))
                }
                <a href="/contact">
                    <Button variant="primary" size="sm"> Get a Quote </Button>
                </a>
            </nav>

            <!-- Mobile Menu Button -->
            <button
                id="mobile-menu-button"
                class="md:hidden text-white p-2"
                aria-label="Toggle menu"
                aria-expanded="false"
            >
                <svg
                    id="menu-icon"
                    class="h-6 w-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
                <svg
                    id="close-icon"
                    class="h-6 w-6 hidden"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div
        id="mobile-menu"
        class="md:hidden absolute top-full left-0 w-full bg-navy border-t border-white/10 shadow-xl hidden"
    >
        <div class="px-4 py-6 space-y-4">
            {
                navLinks.map((link) => (
                    <a
                        href={link.path}
                        class={`block text-base font-medium ${
                            currentPath === link.path
                                ? "text-gold"
                                : "text-slate-300"
                        }`}
                    >
                        {link.name}
                    </a>
                ))
            }
            <a href="/contact" class="block pt-4">
                <Button variant="primary" class="w-full"> Get a Quote </Button>
            </a>
        </div>
    </div>

    <!-- Horizon Line -->
    <div
        class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-gold/30 to-transparent"
    >
    </div>
</header>

<script>
    // Handle scroll effect
    function handleScroll() {
        const header = document.getElementById("main-header");
        if (!header) return;

        if (window.scrollY > 20) {
            header.classList.add(
                "bg-navy/95",
                "backdrop-blur-md",
                "shadow-lg",
                "py-3",
            );
            header.classList.remove("py-5");
        } else {
            header.classList.remove(
                "bg-navy/95",
                "backdrop-blur-md",
                "shadow-lg",
                "py-3",
            );
            header.classList.add("py-5");
        }
    }

    // Handle mobile menu toggle
    function setupMobileMenu() {
        const menuButton = document.getElementById("mobile-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");
        const menuIcon = document.getElementById("menu-icon");
        const closeIcon = document.getElementById("close-icon");

        if (!menuButton || !mobileMenu || !menuIcon || !closeIcon) return;

        menuButton.addEventListener("click", () => {
            const isOpen = !mobileMenu.classList.contains("hidden");

            if (isOpen) {
                mobileMenu.classList.add("hidden");
                menuIcon.classList.remove("hidden");
                closeIcon.classList.add("hidden");
                menuButton.setAttribute("aria-expanded", "false");
            } else {
                mobileMenu.classList.remove("hidden");
                menuIcon.classList.add("hidden");
                closeIcon.classList.remove("hidden");
                menuButton.setAttribute("aria-expanded", "true");
            }
        });

        // Close menu when clicking outside
        document.addEventListener("click", (e) => {
            if (
                !menuButton.contains(e.target as Node) &&
                !mobileMenu.contains(e.target as Node)
            ) {
                mobileMenu.classList.add("hidden");
                menuIcon.classList.remove("hidden");
                closeIcon.classList.add("hidden");
                menuButton.setAttribute("aria-expanded", "false");
            }
        });
    }

    // Initialize on page load
    handleScroll();
    setupMobileMenu();
    window.addEventListener("scroll", handleScroll);

    // Re-initialize after page transitions (for Astro view transitions)
    document.addEventListener("astro:page-load", () => {
        handleScroll();
        setupMobileMenu();
        window.addEventListener("scroll", handleScroll);
    });
</script>
